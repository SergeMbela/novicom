<!--
  On intègre directement la navigation des continents ici.
  - *ngFor="let continent of allContinents" parcourt la liste des continents récupérée dans le composant.
  - (click)="selectContinent(continent.key)" appelle la méthode pour mettre à jour la sélection.
  - [class.active] met en surbrillance le bouton du continent actuellement sélectionné.
-->
<div class="mb-4 border-b border-gray-200 container mx-auto">
  <ul class="flex flex-wrap -mb-px text-sm font-medium text-center justify-center" role="tablist">
    <li *ngFor="let continent of allContinents" class="mr-2" role="presentation">
      <button (click)="selectContinent(continent.key)"
              [ngClass]="{
                'border-blue-600 text-blue-600': (selectedContinentKey$ | async) === continent.key,
                'border-transparent hover:text-gray-600 hover:border-gray-300': (selectedContinentKey$ | async) !== continent.key
              }"
              class="inline-block p-4 border-b-2 rounded-t-lg" type="button" role="tab">
        {{ continent.name[currentLang] }}
      </button>
    </li>
  </ul>
</div>

<!--
  On utilise le déclencheur d'animation [@colorChange] qui est lié à `continentSelectionne`.
  L'animation gère elle-même la transition de couleur, y compris pour l'état initial (null).
  On supprime la liaison [style.backgroundColor] qui était en conflit.
-->
<ng-container *ngIf="continentData$ | async as continentData">
  <div class="container mx-auto p-8 rounded-lg bg-cover bg-center" 
       [@colorChange]="continentData?.key || 'null'"
       [style.backgroundImage]="continentData ? 'url(' + continentData.imageUrl + ')' : 'none'"
       style="min-height: 300px; transition: background-image 0.7s ease-in-out;">

    <div *ngIf="continentData; else noContinent">
      <h1 class="text-4xl font-bold text-white" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.6);">Voyages en {{ continentData.name[currentLang] }}</h1>
      <p class="mt-4 text-white text-lg" style="text-shadow: 1px 1px 6px rgba(0,0,0,0.7);">
        Découvrez nos offres exclusives pour des voyages inoubliables en {{ continentData.name[currentLang] }}.
      </p>

      <!-- Ici, vous pouvez ajouter du contenu dynamique basé sur le continent -->
    </div>
    <ng-template #noContinent>
      <div class="flex flex-col justify-center items-center h-full" style="min-height: 236px;"> <!-- 300px - padding -->
        <h1 class="text-4xl font-bold text-gray-800">Où voyager ?</h1>
        <p class="mt-4 text-gray-600 text-lg">Sélectionnez un continent dans le menu pour découvrir nos destinations.</p>
      </div>
    </ng-template>
  </div>
</ng-container>

<!-- Onglets des sous-régions (déplacés en dehors du conteneur coloré) -->
<!-- We unwrap all necessary observables in a single ng-container for efficiency and clarity -->
<ng-container *ngIf="{ subRegions: subRegions$ | async, selected: selectedSubRegion$ | async } as data">
  <div *ngIf="data.subRegions && data.subRegions.length > 0" class="container mx-auto mt-8">
    <div class="flex border-b border-gray-300">
      <button
        *ngFor="let region of data.subRegions"
        (click)="selectSubRegion(region)"
        class="py-2 px-4 focus:outline-none"
        [ngClass]="{'border-b-2 border-orange-500 text-orange-500': data.selected === region, 'text-gray-500 hover:text-gray-700': data.selected !== region}"
      >
        {{ region.name[currentLang] }}
      </button>
    </div>
    <div *ngIf="data.selected" class="mt-4 p-4 bg-white rounded-lg shadow">
      <h2 class="text-2xl font-semibold text-gray-800">{{ data.selected.name[currentLang] }}</h2>
  
      <!-- Contenu dynamique basé sur la sous-région sélectionnée -->
      <div>
        <p class="mt-2 mb-4 text-gray-700">{{ data.selected.description[currentLang] }}</p>
        <div class="overflow-x-auto mt-4">
          <table class="min-w-full bg-white border border-gray-200">
            <thead class="bg-gray-100">
              <tr>
                <th class="py-3 px-4 border-b text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Pays</th>
                <th class="py-3 px-4 border-b text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Découvrir</th>
              </tr>
            </thead>
            <tbody class="text-gray-700">
              <tr *ngFor="let country of data.selected.countries" class="hover:bg-gray-50">
                <td class="py-3 px-4 border-b">
                  <span class="fi fi-{{ country.flagCode }} mr-3"></span>{{ country.name[currentLang] }}
                </td>
                <td class="py-3 px-4 border-b">
                  <a href="#" class="text-orange-600 hover:text-orange-800 hover:underline">Voir les offres</a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</ng-container>